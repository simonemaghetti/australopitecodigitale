<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASCII Face - Blue Toggle UI</title>
    <style>
        body { background-color: #111; margin: 0; overflow: hidden; display: flex; justify-content: center; align-items: center; height: 100vh; }
        
        #controls {
            position: fixed; top: 20px; left: 20px; display: flex; align-items: center; gap: 15px;
            padding: 10px 25px; background: rgba(255, 255, 255, 0.08); border-radius: 50px;
            backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.1); z-index: 1000;
        }

        input[type='range'] { -webkit-appearance: none; width: 80px; height: 4px; background: rgba(255, 255, 255, 0.2); border-radius: 2px; outline: none; }
        input[type='range']::-webkit-slider-thumb { -webkit-appearance: none; width: 16px; height: 16px; background: #fff; border-radius: 50%; cursor: pointer; }

        .ui-btn {
            width: 22px; height: 22px; border: 2px solid rgba(255, 255, 255, 0.5);
            cursor: pointer; transition: all 0.3s ease; position: relative;
            display: flex; align-items: center; justify-content: center;
        }
        
        #asciiBtn { border: none; width: 0; height: 0; border-left: 11px solid transparent; border-right: 11px solid transparent; border-bottom: 20px solid rgba(255, 255, 255, 0.5); background: none; }
        #asciiBtn.active { border-bottom-color: #fff; filter: drop-shadow(0 0 8px #fff); }

        #circleBtn { border-radius: 50%; }
        #circleBtn.active { background: #fff; border-color: #fff; box-shadow: 0 0 10px #fff; }

        #rectBtn { border-radius: 4px; }
        #rectBtn.active { background: #fff; border-color: #fff; box-shadow: 0 0 10px #fff; }

        /* Pulsante Colore con il blu della pelle invertita */
        #colorToggle { border-radius: 50%; font-size: 12px; color: white; font-family: sans-serif; font-weight: bold; }
        #colorToggle.active { 
            background: #00bfff; 
            border-color: #00bfff; 
            color: #000; 
            box-shadow: 0 0 15px rgba(0, 191, 255, 0.7); 
        }
    </style>
</head>
<body>

    <div id="controls">
        <input id="scaleRange" type="range" min="0.1" max="2" step="0.001" value="1">
        <div id="asciiBtn" class="ui-btn active"></div>
        <div id="circleBtn" class="ui-btn"></div>
        <div id="rectBtn" class="ui-btn"></div>
        <div id="colorToggle" class="ui-btn">C</div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/p5@1.11.11/lib/p5.min.js"></script>
    <script>
        let faccione;
        let scaleFactor = 1;
        let mode = 'ascii'; 
        let originalColors = false;
        let slider;
        const diamondDensity = '◆◇■□▲△▼▽●○★☆@#%&+=- ';

        function preload() {
            faccione = loadImage('simon.jpeg');
        }

        function setup() {
            createCanvas(windowWidth, windowHeight);
            textAlign(CENTER, CENTER);
            rectMode(CENTER);

            slider = document.getElementById('scaleRange');
            slider.addEventListener('input', (e) => { scaleFactor = parseFloat(e.target.value); });

            const btns = {
                'ascii': document.getElementById('asciiBtn'),
                'circle': document.getElementById('circleBtn'),
                'rect': document.getElementById('rectBtn')
            };

            Object.keys(btns).forEach(m => {
                btns[m].addEventListener('click', () => {
                    mode = m;
                    Object.values(btns).forEach(b => b.classList.remove('active'));
                    btns[m].classList.add('active');
                });
            });

            const colorBtn = document.getElementById('colorToggle');
            colorBtn.addEventListener('click', () => {
                originalColors = !originalColors;
                colorBtn.classList.toggle('active', originalColors);
            });

            if (faccione) {
                faccione.resize(80, 0); 
                faccione.loadPixels();
            }
        }

        function mouseWheel(event) {
            let zoomFactor = 0.05;
            if (event.delta > 0) scaleFactor /= (1 + zoomFactor);
            else scaleFactor *= (1 + zoomFactor);
            scaleFactor = constrain(scaleFactor, 0.1, 2);
            slider.value = scaleFactor;
            return false;
        }

        function windowResized() { resizeCanvas(windowWidth, windowHeight); }

        function draw() {
            background(0);
            if (!faccione) return;

            let d = 12;
            let time = frameCount * 0.03;
            let wavePower = 12 * scaleFactor; 
            let centerX = width / 2;
            let centerY = height / 2;
            let imgW = faccione.width;
            let imgH = faccione.height;
            let halfW = (imgW * d) / 2;
            let halfH = (imgH * d) / 2;
            let fIndex = Math.floor(frameCount / 2);
            let size = d * scaleFactor;

            if (mode === 'ascii') textSize(Math.max(4, size));

            for (let j = 0; j < imgH; j++) {
                for (let i = 0; i < imgW; i++) {
                    let idx = (i + j * imgW) * 4;
                    let r = faccione.pixels[idx];
                    let g = faccione.pixels[idx+1];
                    let b = faccione.pixels[idx+2];
                    if (faccione.pixels[idx+3] < 128) continue;

                    let ang = time + (i + j) * 0.15;
                    let px = centerX + (i * d - halfW + cos(ang) * wavePower) * scaleFactor;
                    let py = centerY + (j * d - halfH + sin(ang) * wavePower) * scaleFactor;

                    if (originalColors) {
                        fill(r, g, b);
                    } else {
                        fill(255 - r, 255 - g, 255 - b);
                    }
                    
                    noStroke();

                    if (mode === 'circle') {
                        let s = Math.max(2, size * 0.75);
                        ellipse(px, py, s, s);
                    } else if (mode === 'rect') {
                        let s = size * 0.9;
                        rect(px, py, s, s);
                    } else {
                        let pattern = Math.floor((i + j) / 3) % 2;
                        let diag = (i + j + fIndex) % diamondDensity.length;
                        let alt = (i - j + fIndex * 2) % diamondDensity.length;
                        let charIdx = pattern === 0 ? diag : alt;
                        if (charIdx < 0) charIdx += diamondDensity.length;
                        text(diamondDensity[charIdx], px, py);
                    }
                }
            }
        }
    </script>
</body>
</html>